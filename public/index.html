<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Test</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/4.0.0/lumen/bootstrap.min.css" />
    <link rel="stylesheet" href="css/styles.css" media="screen" title="no title">
    <script src="https://code.jquery.com/jquery.js"></script>
    <script src="js/index.js"></script>
    <style> 
        #map {
            height: 500px;
        }
    </style>
</head>
<body>
    <form>
        <input id="myloc" type="text" value="30.267140, -97.743076">
        <input type="number" name="distance" id="distance" value="10"> 
        <input type="checkbox" class="sports" name="baseball" id="baseball">Baseball
        <input type="checkbox" class="sports" name="basketball" id="basketball">Basketball
        <input type="checkbox" class="sports" name="soccer" id="soccer" checked>Soccer
        <input type="datetime-local" name="starttime" id="starttime" value="2019-02-25T15:30">No Later Than
        <input type="submit" name="submit" id="test">
    </form>
    <br>
    <br>
    <br>
    <div id="map"></div>
    <script>
    $(document).ready(function() {

        $("#test").on("click", function(event) {
            event.preventDefault();
            filterSearch();
        });
        
        function filterSearch() {
            var checks = $(".sports");
            var starttime = $("#starttime").val();
            var mysports = [];
            var testdate = new Date();
            for (let i = 0; i < 3; i++) {
                if (checks[i].checked == true) {
                    mysports.push(checks[i].id);
                }
            }
            var myfilter = {
                location: $("#myloc").val(),
                distance: $("#distance").val(),
                sports: mysports,
                endtime: starttime
                };
            $.ajax({
                url: "/api/filter",
                method: "PUT",
                data: myfilter,
                dataType: 'json'
            }).then(function(results) {
                console.log(results);
            });
        }   
        
    });
    var map;
    var marker = null;
    function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
            center: {lat: 30.314786, lng: -97.738267},
            zoom: 12
        });
        map.addListener('click', function(e) {
            if (marker != null) {
                marker.setMap(null);
            }
            placeMarkerAndPanTo(e.latLng, map);
        });
    } 
    function placeMarkerAndPanTo(latLng, map) {
        
        marker = new google.maps.Marker({
            position: latLng,
            map: map
        });
        var lat = marker.getPosition().lat();
        var long =  marker.getPosition().lng();
        var coords = lat+", "+long;
        console.log(coords);
        $("#myloc").val(coords);
        //map.panTo(latLng);
}
    </script>
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDeVsDpithk85NHs2VG00TxrDQnM6PfMcg&callback=initMap"
    async defer></script>
</body>
</html>
